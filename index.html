<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGC | ISO Management System</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"> <link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="globalLoader" class="loader-overlay">
    <div class="spinner"></div>
    <p>Cargando Sistema SGC...</p>
</div>

<div id="app">
    <div id="loginScreen" class="screen flex-center">
        <div class="login-container">
            <div class="login-header">
                <span class="material-icons-round logo-icon">verified</span>
                <h1>Acceso Corporativo</h1>
                <p>Sistema de Gestión de Calidad ISO 9001</p>
            </div>
            <form id="loginForm" onsubmit="return false;">
                <div class="input-group">
                    <span class="material-icons-round">person</span>
                    <input id="loginUser" type="text" placeholder="Usuario / ID" required>
                </div>
                <div class="input-group">
                    <span class="material-icons-round">lock</span>
                    <input id="loginPass" type="password" placeholder="Contraseña" required>
                </div>
                <button id="btnLogin" class="btn-primary full-width">
                    Iniciar Sesión <span class="material-icons-round">arrow_forward</span>
                </button>
            </form>
            <div class="login-footer">
                <button id="btnCrearAdmin" class="link-btn">Inicializar Sistema (Primer uso)</button>
            </div>
        </div>
    </div>

    <div id="dashboard" class="screen layout hide">
        <aside class="sidebar">
            <div class="brand">
                <span class="material-icons-round">verified_user</span>
                <span>SGC <strong>Pro</strong></span>
            </div>
            
            <nav class="nav-menu">
                <button class="nav-item active" data-tab="tabDashboard">
                    <span class="material-icons-round">dashboard</span> Dashboard
                </button>
                <button class="nav-item" data-tab="tabSolicitudes">
                    <span class="material-icons-round">description</span> Documentos
                </button>
                <div class="admin-only">
                    <div class="nav-divider">ADMINISTRACIÓN</div>
                    <button class="nav-item" data-tab="tabUsuarios">
                        <span class="material-icons-round">manage_accounts</span> Usuarios
                    </button>
                    <button class="nav-item" data-tab="tabReportes">
                        <span class="material-icons-round">analytics</span> Auditoría
                    </button>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-mini-profile">
                    <div class="avatar" id="userAvatar">U</div>
                    <div class="info">
                        <span id="userLogged">Usuario</span>
                        <small id="userRoleDisplay">Rol</small>
                    </div>
                </div>
                <button id="btnLogout" class="btn-icon" title="Cerrar Sesión">
                    <span class="material-icons-round">logout</span>
                </button>
            </div>
        </aside>

        <main class="content">
            <header class="top-bar">
                <h2 id="pageTitle">Resumen General</h2>
                <div class="actions">
                    <div class="search-box">
                        <span class="material-icons-round">search</span>
                        <input type="text" id="globalSearch" placeholder="Buscar documento...">
                    </div>
                    <button id="btnNotif" class="btn-icon relative">
                        <span class="material-icons-round">notifications</span>
                        <span class="badge-dot" id="notifBadge"></span>
                    </button>
                </div>
            </header>

            <section id="tabDashboard" class="view active">
                <div class="stats-row">
                    <div class="card stat-card">
                        <div class="icon bg-blue"><span class="material-icons-round">folder</span></div>
                        <div class="data">
                            <h3>Total Docs</h3>
                            <span id="statTotal" class="num">0</span>
                        </div>
                    </div>
                    <div class="card stat-card">
                        <div class="icon bg-orange"><span class="material-icons-round">pending_actions</span></div>
                        <div class="data">
                            <h3>Pendientes</h3>
                            <span id="statPendientes" class="num">0</span>
                        </div>
                    </div>
                    <div class="card stat-card">
                        <div class="icon bg-green"><span class="material-icons-round">verified</span></div>
                        <div class="data">
                            <h3>Aprobados</h3>
                            <span id="statAprobados" class="num">0</span>
                        </div>
                    </div>
                </div>

                <div class="grid-2-1">
                    <div class="card">
                        <div class="card-header">
                            <h3>Actividad Mensual</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="mainChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Historial Reciente</h3>
                        </div>
                        <div id="historialList" class="timeline-container">
                            </div>
                    </div>
                </div>
            </section>

            <section id="tabSolicitudes" class="view">
                <div class="toolbar">
                    <div class="filters">
                        <select id="filterState" class="form-select">
                            <option value="all">Todos los Estados</option>
                            <option value="Pendiente">Pendientes</option>
                            <option value="Aprobado">Aprobados</option>
                        </select>
                    </div>
                    <button onclick="toggleModal('modalSolicitud')" class="btn-primary">
                        <span class="material-icons-round">add</span> Nueva Solicitud
                    </button>
                </div>

                <div class="card no-padding">
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Documento</th>
                                    <th>Tipo</th>
                                    <th>Versión</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="solTableBody">
                                </tbody>
                        </table>
                    </div>
                    <div id="emptyState" class="empty-state hide">
                        <img src="https://cdn-icons-png.flaticon.com/512/7486/7486747.png" alt="Vacio">
                        <p>No se encontraron documentos</p>
                    </div>
                </div>
            </section>

             <section id="tabUsuarios" class="view">
                 <div class="card">
                     <h3>Gestión de Acceso</h3>
                     <div class="form-grid">
                         <input id="newUserName" placeholder="Nombre Usuario" class="form-input">
                         <input id="newUserPass" placeholder="Contraseña" class="form-input">
                         <select id="newUserRole" class="form-select">
                             <option value="user">Usuario Estándar</option>
                             <option value="admin">Administrador</option>
                         </select>
                         <button onclick="crearUsuario()" class="btn-secondary">Crear Usuario</button>
                     </div>
                     <div id="usersList" class="user-list-grid"></div>
                 </div>
             </section>
        </main>
    </div>

    <div id="modalSolicitud" class="modal-overlay hide">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Nueva Solicitud ISO</h3>
                <button onclick="toggleModal('modalSolicitud')" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-grid-2">
                    <div class="field">
                        <label>Título / Código</label>
                        <input id="solTitle" class="form-input" placeholder="Ej: MAN-001 Manual Calidad">
                    </div>
                    <div class="field">
                        <label>Tipo Documento</label>
                        <select id="solTipo" class="form-select">
                            <option value="Manual">Manual</option>
                            <option value="Procedimiento">Procedimiento</option>
                            <option value="Instructivo">Instructivo</option>
                            <option value="Formato">Formato</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-grid-2">
                    <div class="field">
                        <label>Acción</label>
                        <select id="solAccion" class="form-select" onchange="checkModType()">
                            <option value="Creación">Creación</option>
                            <option value="Modificación">Modificación</option>
                            <option value="Inactivación">Inactivación</option>
                        </select>
                    </div>
                    <div class="field">
                        <label>Versión</label>
                        <input id="solVersion" class="form-input" placeholder="Ej: 1.0">
                    </div>
                </div>

                <div class="field">
                    <label>Fecha Última Versión (Si aplica)</label>
                    <input id="solLastDate" type="date" class="form-input" disabled>
                </div>

                <div class="field">
                    <label>Justificación / Descripción</label>
                    <textarea id="solDesc" class="form-input" rows="3"></textarea>
                </div>

                <div class="file-drop-area">
                    <span class="material-icons-round">cloud_upload</span>
                    <p>Arrastra archivo o clic aquí</p>
                    <input type="file" id="solFile">
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="toggleModal('modalSolicitud')" class="btn-text">Cancelar</button>
                <button onclick="crearSolicitud()" class="btn-primary">Enviar a Revisión</button>
            </div>
        </div>
    </div>

    <div id="modalFirma" class="modal-overlay hide">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Firma de Aprobación</h3>
            </div>
            <div class="modal-body center">
                <p class="text-sm">Yo, <b id="signerName">Admin</b>, certifico la validez de este documento.</p>
                <div class="signature-wrapper">
                    <canvas id="signaturePad" width="400" height="200"></canvas>
                    <small>Firme dentro del recuadro</small>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btnClearSign" class="btn-text">Borrar</button>
                <button id="btnConfirmSign" class="btn-primary">Firmar y Aprobar</button>
            </div>
        </div>
    </div>

</div>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script type="module" src="app.js"></script>
</body>
</html>
