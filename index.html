<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Gestión FCI</title>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.0/axios.min.js"></script>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
input, select, textarea, button { margin: 5px 0; display: block; width: 300px; padding: 5px; }
</style>
</head>
<body>

<h2>Login</h2>
<input type="text" id="usuario" placeholder="Usuario">
<input type="password" id="contraseña" placeholder="Contraseña">
<button onclick="login()">Ingresar</button>
<hr>

<div id="panel" style="display:none;">
<h2>Panel de Gestión</h2>

<h3>Crear Usuario</h3>
<input type="text" id="nuevoUsuario" placeholder="Usuario">
<input type="password" id="nuevaContraseña" placeholder="Contraseña">
<input type="email" id="nuevoCorreo" placeholder="Correo para notificaciones">
<label>Permisos:</label>
<label><input type="checkbox" id="permSolicitudes"> Realizar solicitudes</label>
<label><input type="checkbox" id="permVerPropias"> Ver solicitudes propias</label>
<label><input type="checkbox" id="permVerGerencia"> Ver solicitudes de gerencia</label>
<label><input type="checkbox" id="permAprobar"> Aprobar/Rechazar solicitudes</label>
<label><input type="checkbox" id="permGestionarUsuarios"> Gestionar usuarios</label>
<button onclick="crearUsuario()">Crear Usuario</button>

<h3>Lista de Usuarios</h3>
<ul id="listaUsuarios"></ul>

<h3>Solicitudes</h3>
<button onclick="cargarSolicitudes()">Cargar Solicitudes</button>
<ul id="listaSolicitudes"></ul>

</div>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDdzCiachuhbE9jATz-TesPI2vUVIJrHjM",
  authDomain: "sistemadegestion-7400d.firebaseapp.com",
  projectId: "sistemadegestion-7400d",
  storageBucket: "sistemadegestion-7400d.firebasestorage.app",
  messagingSenderId: "709030283072",
  appId: "1:709030283072:web:5997837b36a448e9515ca5"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Usuarios iniciales
let usuarios = [
  {usuario:"Admin", contraseña:"1130", correo:"admin@fci.com", permisos:["Realizar solicitudes","Ver solicitudes propias","Ver solicitudes de gerencia","Aprobar/Rechazar solicitudes","Gestionar usuarios"]}
];

// Login del sistema
function login(){
    const user = document.getElementById("usuario").value;
    const pass = document.getElementById("contraseña").value;
    const found = usuarios.find(u => u.usuario===user && u.contraseña===pass);
    if(found){
        alert("Bienvenido "+found.usuario);
        document.getElementById("panel").style.display="block";
        cargarUsuarios();
    } else {
        alert("Usuario o contraseña incorrectos");
    }
}

// Crear usuario
function crearUsuario(){
    const user = document.getElementById("nuevoUsuario").value;
    const pass = document.getElementById("nuevaContraseña").value;
    const correo = document.getElementById("nuevoCorreo").value;
    const permisos = [];
    if(document.getElementById("permSolicitudes").checked) permisos.push("Realizar solicitudes");
    if(document.getElementById("permVerPropias").checked) permisos.push("Ver solicitudes propias");
    if(document.getElementById("permVerGerencia").checked) permisos.push("Ver solicitudes de gerencia");
    if(document.getElementById("permAprobar").checked) permisos.push("Aprobar/Rechazar solicitudes");
    if(document.getElementById("permGestionarUsuarios").checked) permisos.push("Gestionar usuarios");

    if(!user || !pass) { alert("Usuario y contraseña obligatorios"); return; }

    const nuevo = {usuario:user, contraseña:pass, correo:correo, permisos:permisos};
    usuarios.push(nuevo);
    alert("Usuario creado: "+user);
    cargarUsuarios();
}

// Cargar lista de usuarios
function cargarUsuarios(){
    const lista = document.getElementById("listaUsuarios");
    lista.innerHTML="";
    usuarios.forEach(u=>{
        const li = document.createElement("li");
        li.innerText = u.usuario + " - Permisos: " + u.permisos.join(", ");
        lista.appendChild(li);
    });
}

// Funciones de solicitudes (ejemplo)
async function cargarSolicitudes(){
    const ul = document.getElementById("listaSolicitudes");
    ul.innerHTML="";
    const snapshot = await db.collection("solicitudes").get();
    snapshot.forEach(doc=>{
        const data = doc.data();
        const li = document.createElement("li");
        li.innerHTML = `Solicitud: ${data.nombreDocumento} - Tipo: ${data.tipo} - Acción: ${data.accion} - Estado: ${data.estado}`;
        ul.appendChild(li);
    });
}

</script>
</body>
</html>